#/bin/bash
#
# Runs when dpkg --remove makeswap-on-azure.service is called
# Removes configuration file and swap file, if present
readonly DEPRECATED_DIR_A="/var/local/makeswap-on-azure"
readonly DEPRECATED_DIR_B="/usr/local/etc/makeswap-on-azure"
readonly SWAP_FILE="/mnt/pagefile"
<<<<<<< Updated upstream
readonly PARAMETER_FILE_DIR="/var/local/makeswap-on-azure"
=======
readonly PARAMETER_FILE_DIR="/etc/makeswap-on-azure"
>>>>>>> Stashed changes

# Usage: logger "This will be logged."
logger() {
    echo "[makeswap-on-azure]: $*" >&1
}

# Usage: err "This is sent to STDERR before returning 1 on exit."
err() {
    echo "[makeswap-on-azure]: $*" >&2
    exit 1
}

if [ -f "$SWAP_FILE" ]; then
    swapoff $SWAP_FILE
    if (($? == 0)); then
        echo "[makeswap-on-azure]: Swap file disabled." > /dev/kmsg
    else
        echo "[makeswap-on-azure]: Failed to disable swap file." > /dev/kmsg
    fi

    rm $SWAP_FILE
    if (($? == 0)); then
        echo "[makeswap-on-azure]: Swap file removed." > /dev/kmsg
    else
        echo "[makeswap-on-azure]: Failed to remove swap file." > /dev/kmsg
    fi
fi

if [ -d $PARAMETER_FILE_DIR ]; then
    rm -rf $PARAMETER_FILE_DIR
    if (($? == 0)); then
        echo "[makeswap-on-azure]: Parameter file directory removed." > /dev/kmsg
    else
        echo "[makeswap-on-azure]: Failed to remove parameter file directory." > /dev/kmsg
    fi
fi

if [ -d $DEPRECATED_DIR_A ]; then
    rm -rf $DEPRECATED_DIR_A
    if (($? == 0)); then
        logger "Oringal parameter file directory removed."
    else
        logger "Failed to remove original parameter file directory."
    fi
fi

if [ -d $DEPRECATED_DIR_B ]; then
    rm -rf $DEPRECATED_DIR_B
    if (($? == 0)); then
        logger "Former parameter file directory removed."
    else
        logger "Failed to remove former parameter file directory."
    fi
fi